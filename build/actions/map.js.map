{"version":3,"sources":["map.js"],"names":["clearingLocation","settingLocation","forgetPlace","rememberPlace","forgetStop","rememberStop","clearLocation","payload","dispatch","getState","setLocation","otpState","otp","reverseGeocode","config","geocoder","reverse","point","location","then","type","catch","err","console","warn","setLocationToCurrent","currentPosition","error","coords","lat","latitude","lon","longitude","name","category","switchLocations","currentQuery","from","to","showLegDiagram","setElevationPoint","setMapPopupLocation","setMapPopupLocationAndGeocode"],"mappings":"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","sourcesContent":["import { createAction } from 'redux-actions'\n\nimport { routingQuery } from './api'\nimport { clearActiveSearch } from './form'\nimport getGeocoder from '../util/geocoder'\n\n/* SET_LOCATION action creator. Updates a from or to location in the store\n *\n * payload format: {\n *   type: 'from' or 'to'\n *   location: {\n *     name: (string),\n *     lat: (number)\n *     lat: (number)\n *   }\n */\n\n// Private actions\nconst clearingLocation = createAction('CLEAR_LOCATION')\nconst settingLocation = createAction('SET_LOCATION')\n\n// Public actions\nexport const forgetPlace = createAction('FORGET_PLACE')\nexport const rememberPlace = createAction('REMEMBER_PLACE')\nexport const forgetStop = createAction('FORGET_STOP')\nexport const rememberStop = createAction('REMEMBER_STOP')\n\nexport function clearLocation (payload) {\n  return function (dispatch, getState) {\n    // Dispatch the clear location action and then clear the active search (so\n    // that the map and narrative are not showing a search when one or both\n    // locations are not defined).\n    dispatch(clearingLocation(payload))\n    dispatch(clearActiveSearch())\n  }\n}\n\nexport function setLocation (payload) {\n  return function (dispatch, getState) {\n    const otpState = getState().otp\n\n    // reverse geocode point location if requested\n    if (payload.reverseGeocode) {\n      getGeocoder(otpState.config.geocoder)\n        .reverse({ point: payload.location })\n        .then((location) => {\n          dispatch(settingLocation({\n            type: payload.type,\n            location\n          }))\n        }).catch(err => {\n          dispatch(settingLocation({\n            type: payload.type,\n            location: payload.location\n          }))\n          console.warn(err)\n        })\n    } else {\n      // update the location in the store\n      dispatch(settingLocation(payload))\n    }\n  }\n}\n\n/* payload is simply { type: 'from'|'to' }; location filled in automatically */\n\nexport function setLocationToCurrent (payload) {\n  return function (dispatch, getState) {\n    const currentPosition = getState().otp.location.currentPosition\n    if (currentPosition.error || !currentPosition.coords) return\n    payload.location = {\n      lat: currentPosition.coords.latitude,\n      lon: currentPosition.coords.longitude,\n      name: '(Current Location)',\n      category: 'CURRENT_LOCATION'\n    }\n    dispatch(settingLocation(payload))\n  }\n}\n\nexport function switchLocations () {\n  return function (dispatch, getState) {\n    const { from, to } = getState().otp.currentQuery\n    // First, reverse the locations.\n    dispatch(settingLocation({\n      type: 'from',\n      location: to\n    }))\n    dispatch(settingLocation({\n      type: 'to',\n      location: from\n    }))\n    // Then kick off a routing query (if the query is invalid, search will abort).\n    dispatch(routingQuery())\n  }\n}\n\nexport const showLegDiagram = createAction('SHOW_LEG_DIAGRAM')\n\nexport const setElevationPoint = createAction('SET_ELEVATION_POINT')\n\nexport const setMapPopupLocation = createAction('SET_MAP_POPUP_LOCATION')\n\nexport function setMapPopupLocationAndGeocode (payload) {\n  return function (dispatch, getState) {\n    dispatch(setMapPopupLocation(payload))\n    getGeocoder(getState().otp.config.geocoder)\n      .reverse({ point: payload.location })\n      .then((location) => {\n        dispatch(setMapPopupLocation({ location }))\n      }).catch(err => {\n        console.warn(err)\n      })\n  }\n}\n"]}