{"version":3,"sources":["profile.js"],"names":["filterProfileOptions","response","optStrs","filteredIndices","filteredProfile","otp","profile","filter","option","i","optStr","access","map","a","mode","join","transit","routes","route","id","indexOf","push","filteredJourneys","journeys","journey","profileOptionsToItineraries","options","query","optionToItinerary","itin","duration","time","legs","walkTime","waitingTime","length","status","walkOnEdges","bikeEdges","walkOffEdges","onStationName","walkOnTime","offStationName","walkOffTime","streetEdges","forEach","edge","bikeRentalOffStation","name","distance","bikeRentalOnStation","transitLeg","from","locationString","to","accessToLeg","fromName","toName","rideStats","avg","averageWait","waitStats","egress","origin","summary","modes","destination","str","defaultStr","split"],"mappings":"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","sourcesContent":["export function filterProfileOptions (response) {\n  // Filter out similar options. TODO: handle on server?\n  const optStrs = []\n  const filteredIndices = []\n\n  const filteredProfile = response.otp.profile.filter((option, i) => {\n    let optStr = option.access.map(a => a.mode).join('/')\n    if (option.transit) {\n      optStr += ' to ' + option.transit.map(transit => {\n        return transit.routes.map(route => route.id).join('/')\n      }).join(',')\n    }\n    if (optStrs.indexOf(optStr) !== -1) return false\n    optStrs.push(optStr)\n    filteredIndices.push(i)\n    return true\n  })\n\n  const filteredJourneys = response.otp.journeys.filter((journey, i) => filteredIndices.indexOf(i) !== -1)\n\n  response.otp.profile = filteredProfile\n  response.otp.journeys = filteredJourneys\n  return response\n}\n\n/** profileOptionsToItineraries **/\n\nexport function profileOptionsToItineraries (options, query) {\n  return options.map(option => optionToItinerary(option, query))\n}\n\n// helper functions for profileOptionsToItineraries:\n\nfunction optionToItinerary (option, query) {\n  const itin = {\n    duration: option.time,\n    legs: [],\n    walkTime: 0,\n    waitingTime: 0\n  }\n\n  // access leg\n  if (option.access && option.access.length > 0) {\n    if (option.access[0].mode === 'BICYCLE_RENT') {\n      let status = 'WALK_ON'\n      const walkOnEdges = []\n      const bikeEdges = []\n      const walkOffEdges = []\n      let onStationName\n      let walkOnTime = 0\n      let offStationName\n      let walkOffTime = 0\n      option.access[0].streetEdges.forEach(edge => {\n        // check if we're returning the bike\n        if (edge.bikeRentalOffStation) {\n          status = 'WALK_OFF'\n          offStationName = edge.bikeRentalOffStation.name\n        }\n\n        if (status === 'WALK_ON') {\n          walkOnEdges.push(edge)\n          walkOnTime += edge.distance\n        } else if (status === 'BIKE') {\n          bikeEdges.push(edge)\n        } else if (status === 'WALK_OFF') {\n          walkOffEdges.push(edge)\n          walkOffTime += edge.distance\n        }\n\n        // check if we're picking up the bike\n        if (edge.bikeRentalOnStation) {\n          status = 'BIKE'\n          onStationName = edge.bikeRentalOnStation.name\n        }\n      })\n\n      itin.walkTime += (walkOnTime + walkOffTime)\n\n      // create the 'on' walk leg\n      itin.legs.push({\n        mode: 'WALK',\n        duration: walkOnTime,\n        transitLeg: false,\n        from: {\n          name: locationString(query && query.from.name, 'Destination')\n        },\n        to: {\n          name: onStationName\n        }\n      })\n\n      // create the bike leg\n      itin.legs.push({\n        mode: 'BICYCLE_RENT',\n        duration: option.time - walkOnTime - walkOffTime,\n        transitLeg: false,\n        from: {\n          name: onStationName\n        },\n        to: {\n          name: offStationName\n        }\n      })\n\n      // create the 'off' walk leg\n      itin.legs.push({\n        mode: 'WALK',\n        duration: walkOffTime,\n        transitLeg: false,\n        from: {\n          name: offStationName\n        },\n        to: {\n          name: locationString(query && query.to.name, 'Destination')\n        }\n      })\n    } else {\n      itin.legs.push(accessToLeg(option.access[0], query && query.from.name, option.transit ? null : query && query.to.name))\n      if (option.access[0].mode === 'WALK') itin.walkTime += option.access[0].time\n    }\n  }\n\n  // transit legs\n  if (option.transit) {\n    option.transit.forEach(transit => {\n      itin.legs.push({\n        transitLeg: true,\n        mode: transit.mode,\n        from: {\n          name: transit.fromName\n        },\n        to: {\n          name: transit.toName\n        },\n        routes: transit.routes,\n        duration: transit.rideStats.avg,\n        averageWait: transit.waitStats.avg\n      })\n      itin.waitingTime += transit.waitStats.avg\n    })\n  }\n\n  // egress leg\n  if (option.egress && option.egress.length > 0) {\n    // find the origin name, for transit trips\n    const origin = option.transit ? option.transit[option.transit.length - 1].toName : null\n\n    itin.legs.push(accessToLeg(option.egress[0], origin, query && query.to.name))\n    if (option.egress[0].mode === 'WALK') itin.walkTime += option.egress[0].time\n  }\n\n  // construct summary\n  if (option.transit) {\n    itin.summary = 'Transit'\n  } else {\n    if (option.modes.length === 1 && option.modes[0] === 'bicycle') itin.summary = 'Bicycle'\n    else if (option.modes.length === 1 && option.modes[0] === 'walk') itin.summary = 'Walk'\n    else if (option.modes.indexOf('bicycle_rent') !== -1) itin.summary = 'Bikeshare'\n  }\n\n  return itin\n}\n\nfunction accessToLeg (access, origin, destination) {\n  return {\n    mode: access.mode,\n    duration: access.time,\n    transitLeg: false,\n    from: {\n      name: locationString(origin, 'Origin')\n    },\n    to: {\n      name: locationString(destination, 'Destination')\n    }\n  }\n}\n\nfunction locationString (str, defaultStr) {\n  return str ? str.split(',')[0] : defaultStr\n}\n"]}